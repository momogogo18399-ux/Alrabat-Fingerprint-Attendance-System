# 🔄 Hybrid Database System Guide

## نظرة عامة

النظام الهجين يجمع بين **قاعدة البيانات المحلية (SQLite)** و **Supabase** لتوفير:
- ⚡ **سرعة عالية** في الاستجابة
- 🌐 **مزامنة تلقائية** مع السحابة
- 📱 **عمل بدون إنترنت**
- 👥 **مشاركة البيانات** بين المستخدمين

## 🚀 كيفية العمل

### 1. **عند فتح البرنامج لأول مرة:**
```
📁 إنشاء قاعدة بيانات SQLite محلية
🔄 الاتصال بـ Supabase
📥 تحميل البيانات الموجودة من Supabase
✅ جاهز للعمل
```

### 2. **خلال العمل:**
```
💾 حفظ البيانات محلياً (فوري)
📝 تسجيل التغييرات للمزامنة
🔄 مزامنة تلقائية كل 5 دقائق
```

### 3. **عند إغلاق البرنامج:**
```
🔄 مزامنة نهائية مع Supabase
🗑️ حذف قاعدة البيانات المحلية
✅ البيانات محدثة للجميع
```

## ⚙️ الإعدادات

### ملف `.env`:
```env
# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key

# Hybrid Database System Settings
HYBRID_MODE=true
SYNC_INTERVAL=300
AUTO_SYNC=true
DELETE_LOCAL_ON_EXIT=true
```

### المعاملات:
- `HYBRID_MODE`: تفعيل/إلغاء النظام الهجين
- `SYNC_INTERVAL`: فترة المزامنة التلقائية (بالثواني)
- `AUTO_SYNC`: المزامنة التلقائية
- `DELETE_LOCAL_ON_EXIT`: حذف قاعدة البيانات المحلية عند الخروج

## 📊 مراقبة المزامنة

### في واجهة الإعدادات:
- **حالة المزامنة**: Connected/Error/Syncing
- **التغييرات المعلقة**: عدد التغييرات التي تنتظر المزامنة
- **آخر مزامنة**: وقت آخر مزامنة ناجحة
- **زر المزامنة اليدوية**: لمزامنة فورية

## 🔧 استكشاف الأخطاء

### مشاكل شائعة:

#### 1. **خطأ في الاتصال بـ Supabase:**
```
❌ المشكلة: لا يمكن الاتصال بـ Supabase
✅ الحل: 
- تحقق من صحة بيانات Supabase في .env
- تأكد من وجود اتصال بالإنترنت
- النظام سيعمل محلياً حتى يعود الاتصال
```

#### 2. **تأخير في المزامنة:**
```
❌ المشكلة: المزامنة بطيئة
✅ الحل:
- تحقق من سرعة الإنترنت
- قلل عدد التغييرات المعلقة
- استخدم المزامنة اليدوية
```

#### 3. **تعارض في البيانات:**
```
❌ المشكلة: بيانات مختلفة بين المستخدمين
✅ الحل:
- النظام يحل التعارض تلقائياً
- آخر تعديل يفوز
- يمكن مراجعة سجل التغييرات
```

## 📈 المميزات

### ✅ **السرعة:**
- استجابة فورية للعمليات
- لا انتظار للاتصال بالإنترنت
- أداء محسن

### ✅ **الموثوقية:**
- نسخ احتياطية تلقائية
- استمرارية العمل بدون إنترنت
- حماية من فقدان البيانات

### ✅ **المشاركة:**
- بيانات محدثة للجميع
- مزامنة فورية
- إدارة مركزية

### ✅ **المرونة:**
- يمكن العمل بدون إنترنت
- مزامنة عند عودة الاتصال
- تحكم في إعدادات المزامنة

## 🛠️ التطوير

### إضافة جدول جديد:
```python
# في hybrid_database_manager.py
def add_new_table(self, table_data):
    # إضافة محلياً
    result = self.local_db.add_new_table(table_data)
    
    # إضافة للمزامنة
    if result and self.hybrid_mode:
        self._add_pending_change('new_table', 'INSERT', str(result['id']), table_data)
    
    return result
```

### تخصيص منطق المزامنة:
```python
def _custom_sync_logic(self):
    # منطق مخصص للمزامنة
    pass
```

## 📝 ملاحظات مهمة

1. **الأمان**: البيانات محمية بتشفير Supabase
2. **الأداء**: المزامنة تعمل في الخلفية
3. **المرونة**: يمكن إلغاء النظام الهجين والعودة للمحلي فقط
4. **المراقبة**: سجلات مفصلة لجميع العمليات

## 🆘 الدعم

إذا واجهت أي مشاكل:
1. تحقق من سجلات التطبيق
2. راجع إعدادات Supabase
3. تأكد من صحة ملف `.env`
4. جرب المزامنة اليدوية

---

**النظام الهجين يوفر أفضل تجربة مستخدم مع أقصى موثوقية وأداء! 🚀**
